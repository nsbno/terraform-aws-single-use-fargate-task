## Single Use Fargate Task

This module provides a way of simply running ad-hoc containers in Fargate.

The module creates a Lambda that can be called to run a command of your choosing in a container of your choice with a
volume of content from s3 mounted.

The task can optionally be tracked by an AWS step functions Activity


### Expected Attributes
The lambda expects a json input with the following attributes

#### state_machine_id (Optional)
The name of a Step Function state machine that uses the Lambda function. The Fargate task family will be prefixed with this value (and `state`, if supplied).

#### state (Optional)
The name of the Step Function state that invokes the Lambda function. The Fargate task family will be prefixed with this value (and `state_machine_id`, if supplied).

#### token (Optional)
A token generated by a task in a Step Function. Used to report the outcome of the Fargate task to the Step Function task.

#### cmd_to_run (Optional)
A command to be run in the container - this will be run after any content has been unzipped

#### content (Optional)
The s3 uri of a zip file to be unzipped into a folder mounted at `/tmp/workspace`.

#### task_cpu (Optional)
The task CPU (CPU units or vCPUs) for the Fargate task, defaults to 256. (_Supported values can be found here: https://docs.aws.amazon.com/AmazonECS/latest/developerguide/task-cpu-memory-error.html._)

#### task_memory (Optional)
The task memory (MiB) for the Fargate task, defaults to 512. (_Supported values can be found here: https://docs.aws.amazon.com/AmazonECS/latest/developerguide/task-cpu-memory-error.html._)

#### ecs_cluster
The name of the ECS cluster on which to run the fargate task

#### image
The docker uri of the container image to launch

#### subnets
A list of subnets into which this fargate container can be launched

#### task_execution_role_arn
The arn of the role given to Fargate to run tasks - this is typically a role with the managed 
`AmazonECSTaskExecutionRolePolicy` policy attached

#### task_role_arn
The arn of the role the task will assume when running

###### Example
```json
{
  "token": "<step_function_task_token>",
  "state": "<step_function_state>",
  "state_machine_id": "<step_function_state_machine_name>",
  "cmd_to_run": "echo \"Hello World\"",
  "content": "<s3_uri>",
  "ecs_cluster": "test-single-tasks",
  "image": "vydev/terraform:0.12.20",
  "subnets": [
    "<subnet-1>",
    "<subnet-2>",
    "<subnet-2>"
  ],
  "task_execution_role_arn": "test-ECSTaskExecutionRole",
  "task_role_arn": "<task_role_arn>"
}
```
